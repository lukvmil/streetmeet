(function(){"use strict";var e={2131:function(e,n,t){var o=t(9242),r=t(3396);const i={key:0},a={key:1};function u(e,n,t,o,u,l){const s=(0,r.up)("router-link"),c=(0,r.up)("router-view");return e.peerInitialized?((0,r.wg)(),(0,r.iD)("div",a,[(0,r._)("nav",null,[(0,r.Wm)(s,{to:"/"},{default:(0,r.w5)((()=>[(0,r.Uk)("Home")])),_:1}),(0,r.Uk)(" | "),(0,r.Wm)(s,{to:"/about"},{default:(0,r.w5)((()=>[(0,r.Uk)("About")])),_:1})]),(0,r.Wm)(c)])):((0,r.wg)(),(0,r.iD)("div",i,"Loading..."))}var l=t(4870);const s=(0,l.qj)({peerInitialized:!1,users:[],profile:{},chats:{}});var c=t(6265),d=t.n(c);let p;p="https://streetmeet.lukvmil.com/api";const v=d().create({baseURL:p});var f=v;const m=()=>{s.profile._id&&f.post("/user/"+s.profile._id)},g=()=>{setInterval(m,5e3)};var h=(0,r.aZ)({name:"App",setup(){const e=(0,r.Fl)((()=>s.peerInitialized));return window.addEventListener("beforeunload",(()=>{})),g(),{peerInitialized:e}}}),w=t(89);const b=(0,w.Z)(h,[["render",u]]);var y=b,_=t(2483);const k={class:"home"},D=(0,r._)("h1",null,"StreetMeet",-1);function I(e,n,t,o,i,a){const u=(0,r.up)("Info"),l=(0,r.up)("PeopleList");return(0,r.wg)(),(0,r.iD)("div",k,[D,e.profile._id?((0,r.wg)(),(0,r.j4)(l,{key:1})):((0,r.wg)(),(0,r.j4)(u,{key:0}))])}const O=(0,r._)("h1",null,"Hello!",-1);function U(e,n,t,i,a,u){return(0,r.wg)(),(0,r.iD)(r.HY,null,[O,(0,r._)("div",null,[(0,r.wy)((0,r._)("input",{type:"text",placeholder:"Enter a username!","onUpdate:modelValue":n[0]||(n[0]=n=>e.username=n)},null,512),[[o.nr,e.username]])]),(0,r._)("div",null,[(0,r.wy)((0,r._)("input",{type:"text",placeholder:"What's on your mind today?","onUpdate:modelValue":n[1]||(n[1]=n=>e.topic=n)},null,512),[[o.nr,e.topic]])]),(0,r._)("div",null,[(0,r._)("button",{onClick:n[2]||(n[2]=(...n)=>e.submit&&e.submit(...n))},"Submit")])],64)}t(1703),t(7658);var H=t(1113);const j=new H._z;j.on("open",(()=>{s.peerInitialized=!0}));const Z=e=>{const n=j.connect(e);return x(n),n};j.on("connection",(e=>{const n=e;x(n)}));const x=e=>{e&&(e.on("data",(n=>{s.chats[e.peer].messages.push({text:n})})),e.on("open",(()=>{s.chats[e.peer]={messages:[],disconnected:!1,conn:e}})),e.on("close",(()=>{s.chats[e.peer].disconnected=!0})))},z=(e,n)=>{e.conn.send(n),s.chats[e.conn.peer].messages.push({self:!0,text:n})},P=e=>{e.conn.close()};window.peer=j;var C=(0,r.aZ)({name:"InfoVue",setup(){const e=(0,l.iH)(""),n=(0,l.iH)(""),t=(0,l.iH)(),o=e=>{if(!("geolocation"in navigator))throw new Error("Location not available");navigator.geolocation.getCurrentPosition((n=>{t.value={lat:n.coords.latitude,lon:n.coords.longitude},e()}))},r=()=>{o((async()=>{const o=await f.post("/user",{username:e.value,topic:n.value,peerId:j.id,location:[t.value?.lon,t.value?.lat]});console.log(o.data),s.profile=o.data}))};return{username:e,topic:n,submit:r}}});const S=(0,w.Z)(C,[["render",U]]);var T=S,L=t(7139);const M={key:0},V=(0,r._)("h1",null,"People",-1),F={key:1};function W(e,n,t,o,i,a){const u=(0,r.up)("router-link");return e.people?((0,r.wg)(),(0,r.iD)("div",M,[V,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.people,(e=>((0,r.wg)(),(0,r.iD)("div",{key:e._id},[(0,r._)("h3",null,(0,L.zw)(e.username),1),(0,r._)("div",null,"Topic: "+(0,L.zw)(e.topic),1),(0,r.Wm)(u,{to:`message/${e.peerId}`},{default:(0,r.w5)((()=>[(0,r.Uk)("Message")])),_:2},1032,["to"])])))),128))])):((0,r.wg)(),(0,r.iD)("div",F,"Loading..."))}var q=(0,r.aZ)({name:"PeopleList",setup(){const e=(0,l.iH)(),n=(0,r.Fl)((()=>s.profile)),t=async()=>{const n=await f.get("/match/"+s.profile._id);e.value=n.data};t();const o=setInterval(t,2e3);return(0,r.Jd)((()=>{clearInterval(o)})),{people:e,profile:n}}});const E=(0,w.Z)(q,[["render",W]]);var Y=E,A=(0,r.aZ)({name:"HomeView",components:{Info:T,PeopleList:Y},setup(){const e=(0,r.Fl)((()=>s.profile));return{profile:e}}});const K=(0,w.Z)(A,[["render",I]]);var J=K;const R={class:"about"},$=(0,r._)("h1",null,"This is an about page",-1),B=[$];function G(e,n){return(0,r.wg)(),(0,r.iD)("div",R,B)}const N={},Q=(0,w.Z)(N,[["render",G]]);var X=Q;const ee={key:0},ne=(0,r._)("h2",null,"Messages",-1),te={key:0},oe=["disabled"],re=(0,r._)("br",null,null,-1),ie={key:1},ae=["disabled"];function ue(e,n,t,i,a,u){return(0,r.wg)(),(0,r.iD)("div",null,[e.chatData?((0,r.wg)(),(0,r.iD)("div",ee,[ne,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.chatData.messages,(e=>((0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("div",null,[(0,r._)("strong",null,(0,L.zw)(e.self?"You: ":""),1),(0,r.Uk)(" "+(0,L.zw)(e.text),1)])])))),256)),e.chatData.disconnected?((0,r.wg)(),(0,r.iD)("div",te,"Chat disconnected")):(0,r.kq)("",!0),(0,r.wy)((0,r._)("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=n=>e.messageInput=n)},null,512),[[o.nr,e.messageInput]]),(0,r._)("button",{onClick:n[1]||(n[1]=(...n)=>e.send&&e.send(...n)),disabled:e.chatData.disconnected},"Send",8,oe),(0,r.Uk)(),re,e.chatData.disconnected?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:1,onClick:n[2]||(n[2]=(...n)=>e.dc&&e.dc(...n))},"Disconnect"))])):((0,r.wg)(),(0,r.iD)("div",ie,[(0,r._)("button",{onClick:n[3]||(n[3]=(...n)=>e.connectToUser&&e.connectToUser(...n)),disabled:e.connectDisabled}," Connect to user ",8,ae)]))])}var le=(0,r.aZ)({name:"MessageVue",props:{peerId:{type:String,required:!0}},setup(e){s.profile._id||ve.push("/");const n=(0,l.iH)(""),t=(0,r.Fl)((()=>s.chats[e.peerId])),o=()=>{t.value&&(z(t.value,n.value),n.value="")},i=()=>{t.value&&P(t.value)},a=(0,l.iH)(!1),u=()=>{a.value=!0,Z(e.peerId)};return{chatData:t,messageInput:n,send:o,dc:i,connectToUser:u,connectDisabled:a}}});const se=(0,w.Z)(le,[["render",ue]]);var ce=se;const de=[{path:"/",name:"home",component:J},{path:"/about",name:"about",component:X},{path:"/message/:peerId",name:"message",props:e=>({peerId:e.params.peerId}),component:ce}],pe=(0,_.p7)({history:(0,_.PO)(""),routes:de});var ve=pe;const fe=(0,o.ri)(y);fe.use(ve),fe.mount("#app")}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={exports:{}};return e[o](i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(n,o,r,i){if(!o){var a=1/0;for(c=0;c<e.length;c++){o=e[c][0],r=e[c][1],i=e[c][2];for(var u=!0,l=0;l<o.length;l++)(!1&i||a>=i)&&Object.keys(t.O).every((function(e){return t.O[e](o[l])}))?o.splice(l--,1):(u=!1,i<a&&(a=i));if(u){e.splice(c--,1);var s=r();void 0!==s&&(n=s)}}return n}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[o,r,i]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,o){var r,i,a=o[0],u=o[1],l=o[2],s=0;if(a.some((function(n){return 0!==e[n]}))){for(r in u)t.o(u,r)&&(t.m[r]=u[r]);if(l)var c=l(t)}for(n&&n(o);s<a.length;s++)i=a[s],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(c)},o=self["webpackChunkclient1"]=self["webpackChunkclient1"]||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))}();var o=t.O(void 0,[998],(function(){return t(2131)}));o=t.O(o)})();
//# sourceMappingURL=app.64a9fa20.js.map